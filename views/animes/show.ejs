<%- include('../partials/html-head') %>
<link rel="stylesheet" href="/stylesheets/style.css">
<%- include('../partials/nav') %>


<main>
  <img src="<%= results.banner_image %>" alt="<%= results.banner_img %>'s Image">
  <img src="<%= results.cover_image %>" alt="<%= results.cover_image %>'s Image">
  <% if (results.trailer_url) {%> 
    <iframe width="560" height="315" src="<%= results.trailer_url %>" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
  <% } %> 
  <h1><%= results.titles.en %> </h1>
  <h2><%= results.titles.jp %> </h2>
  <p><%= results.descriptions.en %> </p>
  <ul>
    <% results.genres.forEach(genre => { %>
      <li><%= genre %> </li>
    <% }) %>
  </ul>
  <% if (!userAnimes) { %> 
    <form action="/anime/<%= results.id %>/addToList?_method=PATCH" method="POST">
      <input type="text" name="animeTitle" value="<%= results.titles.en %>" hidden>
      <input type="text" name="animeId" value="<%= results.id %>" hidden>
      <input type="text" name="coverImage" value="<%= results.cover_image %>" hidden>
      <button class="btn btn-primary">
        Add to Watching
      </button> 
    </form>
  <% }  %> 
  <% if (userAnimes) { %> 
    <form action="/anime/<%= results.id %>/removeFromList?_method=PATCH" method="POST">
      <button class="btn btn-danger">
        Remove from Watching
      </button> 
    </form>
  <% } %> 

  <% if (userAnimes && !userReviewed) { %> 
  <form action="/reviews/<%= results.id %>" method="POST">
    <select class="form-select" name="rating">
      <option selected>Rate</option>
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5</option>
    </select>

    <div class="input-group">
      <span class="input-group-text">Review:</span>
      <textarea class="form-control" name="content"></textarea>
    </div>

    <button class="btn btn-success">Add Review</button>
  </form>
  <% } %> 

  <h2>Reviews:</h2> 

  <% //console.log('Anime Beg') %> 
  <% console.log(anime) %> 
  <% //console.log('Anime End') %> 

  <% if (anime?.reviews.length) { %>
    <% anime.reviews.forEach(review => { %>
      <% //console.log('Reveiw Beg') %> 
      <% console.log(review) %> 
      <% //console.log('Reveiw End') %> 
      <div>
        <h3>Reviwer: <%= review.author.name %> </h3>
      </div>
      <div>
        <p><%= review.content %> </p>
      </div>
    <% }) %>
  <% } %> 
</main>



<%- include('../partials/footer') %></link>